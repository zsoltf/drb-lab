#!/usr/bin/env ruby

require "bundler/setup"
require "nag"
require "drb"
require "rinda/ring"

puts "getting servers"
DRb.start_service
ring_server = Rinda::RingFinger.primary
services = ring_server.read_all [:name, nil, nil, nil]
puts "#{services.size} services on #{ring_server.__drburi}"

services.map! do |service|
  { object: service[1],
    uri: service[2].__drburi,
    description: service[3] }
end
services.sort { |srv1, srv2| srv1[:uri] <=> srv2[:uri]}

#server = DRbObject.new_with_uri(SERVER_URI)
require 'pry';binding.pry
